<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kreator PDF ‚Äì Katalog produkt√≥w</title>
  <link rel="stylesheet" href="kreator.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- DODANO: QUILL.JS -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
</head>
<body>

  <!-- G√ìRNY PASEK -->
  <div class="header-bar">
    <div class="header-left">
      <div class="header-logo">Kreator</div>
      <div class="header-title">Katalog produkt√≥w</div>
    </div>
    <div class="header-center">
      <button class="header-btn active"><i class="fas fa-edit"></i> Edytuj</button>
      <button class="header-btn"><i class="fas fa-eye"></i> PodglƒÖd</button>
    </div>
    <div class="header-right">
      <button class="share-btn"><i class="fas fa-share-alt"></i> Udostƒôpnij</button>
    </div>
  </div>

  <!-- SIDEBAR Z IKONAMI -->
  <div class="sidebar">
    <!-- Dodaj tekst -->
    <div class="sidebar-item" title="Dodaj tekst">
      <i class="fas fa-plus"></i>
      <i class="fas fa-font"></i>
      <span class="sidebar-label">Dodaj tekst</span>
    </div>

    <!-- Dodaj zdjƒôcia -->
    <div class="sidebar-item" title="Dodaj zdjƒôcia">
      <i class="fas fa-plus"></i>
      <i class="fas fa-images"></i>
      <span class="sidebar-label">Dodaj zdjƒôcia</span>
    </div>
    <!-- Import PSD -->
<div class="sidebar-item" title="Import PSD">
  <i class="fas fa-file-image"></i>
  <span class="sidebar-label">Import PSD</span>
</div>

    <!-- Dodaj element -->
<div class="sidebar-item" id="addElementBtn" title="Dodaj element">
  <i class="fas fa-plus"></i>
  <i class="fas fa-shapes"></i>
  <span class="sidebar-label">Dodaj element</span>
</div>

    <!-- Elementy zapisane -->
    <div class="sidebar-item" title="Elementy zapisane">
      <i class="fas fa-save"></i>
      <span class="sidebar-label">Elementy zapisane</span>
    </div>

    <!-- Przesy≈Çanie danych -->
    <div class="sidebar-item" title="Przesy≈Çanie danych">
      <i class="fas fa-cloud-upload-alt"></i>
      <span class="sidebar-label">Przesy≈Çanie danych</span>
    </div>
 <!-- Rysowanie -->
   <div class="sidebar-item" title="Kszta≈Çty">
  <i class="fas fa-draw-polygon"></i>
  <span class="sidebar-label">Kszta≈Çty</span>
</div>



    <!-- Separator -->
    <div class="sidebar-separator"></div>

    <!-- Opcje PDF (istniejƒÖce) -->
    <div class="sidebar-item" title="Opcje PDF">
      <i class="fas fa-cog"></i>
      <span class="sidebar-label">Opcje PDF</span>
    </div>
    <div class="sidebar-item" title="Kod EAN">
      <i class="fas fa-barcode"></i>
      <span class="sidebar-label">Kod EAN</span>
    </div>
    <div class="sidebar-item" title="Cena">
      <i class="fas fa-euro-sign"></i>
      <span class="sidebar-label">Cena</span>
    </div>
    <div class="sidebar-item" title="Ramki">
      <i class="fas fa-border-all"></i>
      <span class="sidebar-label">Ramki</span>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="improved-panel">
      <div class="panel-header">
        <h2 class="panel-title"><i class="fas fa-upload"></i> Import i ustawienia</h2>
      </div>

      <!-- EXCEL -->
      <div class="import-row">
        <div class="file-section">
          <label for="excelFile" class="file-label-wrapper">
            <span id="fileLabel">Nie wybrano pliku</span>
            <input type="file" id="excelFile" accept=".xls,.xlsx,.csv">
          </label>
        </div>
        <button class="btn-primary" id="importExcelBtn"><i class="fas fa-file-excel"></i> Importuj Excel</button>
      </div>

      <!-- UPLOAD KARTY -->
      <div class="upload-grid">
        <!-- BANER -->
        <div class="upload-card">
          <div class="upload-zone" id="bannerUpload">
            <i class="fas fa-image"></i>
            <p>PrzeciƒÖgnij baner tutaj lub <span class="file-label" onclick="document.getElementById('bannerFileInput').click()">kliknij, aby wybraƒá</span></p>
            <input type="file" id="bannerFileInput" accept="image/*">
          </div>
          <div id="bannerPreview" class="upload-preview"></div>
        </div>

        <!-- T≈ÅO -->
        <div class="upload-card">
          <div class="upload-zone" id="backgroundUpload">
            <i class="fas fa-fill-drip"></i>
            <p>PrzeciƒÖgnij t≈Ço tutaj lub <span class="file-label" onclick="document.getElementById('backgroundFileInput').click()">kliknij, aby wybraƒá</span></p>
            <input type="file" id="backgroundFileInput" accept="image/*">
          </div>
          <div id="backgroundPreview" class="upload-preview"></div>
        </div>

        <!-- OK≈ÅADKA -->
        <div class="upload-card">
          <div class="upload-zone" id="coverUpload">
            <i class="fas fa-book"></i>
            <p>PrzeciƒÖgnij ok≈Çadkƒô tutaj lub <span class="file-label" onclick="document.getElementById('coverFileInput').click()">kliknij, aby wybraƒá</span></p>
            <input type="file" id="coverFileInput" accept="image/*">
          </div>
          <div id="coverPreview" class="upload-preview"></div>
        </div>

        <!-- ZDJƒòCIA -->
        <div class="upload-card">
          <div class="upload-zone" id="uploadArea">
            <i class="fas fa-images"></i>
            <p>PrzeciƒÖgnij zdjƒôcia tutaj lub <span class="file-label" onclick="document.getElementById('imageInput').click()">kliknij, aby wybraƒá</span></p>
            <input type="file" id="imageInput" accept="image/*" multiple>
          </div>
        </div>
      </div>

      <!-- IMPORT ZDJƒòƒÜ -->
      <div class="import-row" style="margin-top: 12px; justify-content: center;">
        <button class="btn-primary" id="importImagesBtn"><i class="fas fa-upload"></i> Importuj zdjƒôcia</button>
      </div>

      <!-- PDF BUTTONS ‚Äì TYLKO Generuj PDF i Ustawienia katalogu -->
      <div class="pdf-buttons" style="margin-top: 20px; display:flex; gap:12px;">

    <button id="pdfButton" class="btn-primary" disabled>
        <i class="fas fa-file-pdf"></i> Generuj PDF
    </button>
    

    <!-- üî• NOWY PRZYCISK -->
    <button id="canvaPdfButton" class="btn-primary" style="background:#00a87d;">
        <i class="fas fa-file-export"></i> Export do Canva
    </button>

    <button id="catalogSettingsBtn" class="btn-primary">
        <i class="fas fa-cog"></i> Ustawienia katalogu
    </button>

    <button id="saveProjectBtn" class="btn-primary" style="background:#0077ff;">
        <i class="fas fa-save"></i> Zapisz projekt
    </button>
</div>


    </div>

    <div id="pagesContainer"></div>
  </div>

  <!-- UNDO/REDO BUTTONS -->
  <div id="undoRedoControls" style="position:fixed;top:80px;right:20px;z-index:10000;display:flex;gap:8px;">
    <button id="undoBtn" title="Cofnij (Ctrl+Z)" style="background:#fff;padding:8px 12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;opacity:0.5;" disabled>
      <i class="fas fa-undo"></i>
    </button>
    <button id="redoBtn" title="Przywr√≥ƒá (Ctrl+Y)" style="background:#fff;padding:8px 12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;opacity:0.5;" disabled>
      <i class="fas fa-redo"></i>
    </button>
  </div>

 <!-- ====================== BIBLIOTEKI ZEWNƒòTRZNE ====================== -->

<!-- PSD.js ‚Äî DZIA≈ÅAJƒÑCA wersja (lokalna), NIE CDN -->
<script src="psd.min.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>window.jsPDF = window.jspdf.jsPDF;</script>

<!-- XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Konva -->
<script src="https://unpkg.com/konva@9/konva.min.js"></script>
<!-- Konva SVG EXPORT (Canva support) -->
<script src="https://unpkg.com/konva-svg@1.0.0/konva-svg.min.js"></script>

<!-- Fabric -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<!-- JsBarcode -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<!-- ONNX Runtime -->
<script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>

<!-- Quill -->
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<!-- Rysowanie -->
 <script src="https://unpkg.com/konva-free-draw@1.0.0/konva-free-draw.min.js"></script>


<!-- üî• POPRAWNA I JEDYNA Inicjalizacja Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";

import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    query,
    doc,
    getDoc,
    deleteDoc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import {
    getStorage
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

// üî• KONFIG FIREBASE
const firebaseConfig = {
    apiKey: "AIzaSyDwzVRS5W2lklGMLcZJn-YPCK9OtBQZ7bI",
    authDomain: "pdf-creator-f7a8b.firebaseapp.com",
    projectId: "pdf-creator-f7a8b",
    storageBucket: "pdf-creator-f7a8b.appspot.com",
    messagingSenderId: "606744201676",
    appId: "1:606744201676:web:6f8c1b2c323fbaf6f3b569",
    measurementId: "G-QVPYM3G99P"
};

// üî• INICJALIZACJA
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
// ---------------------------------------------------------------
// üî• DRUGA APLIKACJA FIREBASE ‚Äì PDF-CREATOR-V2 (tylko zapisy projekt√≥w)
// ---------------------------------------------------------------
const firebaseConfig2 = {
  apiKey: "AIzaSyCc8MTmJF7qi3Vk9v1SwMTy6yzSo444f98",
  authDomain: "pdf-creator-v2.firebaseapp.com",
  projectId: "pdf-creator-v2",
  storageBucket: "pdf-creator-v2.firebasestorage.app",
  messagingSenderId: "758727102700",
  appId: "1:758727102700:web:3e9a211a0132a0200b55c9"
};

// üî• Tworzymy DRUGƒÑ aplikacjƒô Firebase
const app2 = initializeApp(firebaseConfig2, "secondary");

// üî• Firestore z DRUGIEGO projektu
const db2 = getFirestore(app2);

// üî• Zapisujemy globalnie, saveall.js bƒôdzie tego u≈ºywaƒá
window.firestoreV2 = db2;

console.log("üî• PDF-CREATOR-V2 Firestore READY!");

// üî• GLOBALNE
window.firebaseApp = app;
window.firebaseDB = db;
window.firebaseStorage = storage;

// üî• EXPORTUJEMY FUNKCJE FIRESTORE DO GLOBALA
window.FS_collection = collection;
window.FS_addDoc = addDoc;
window.FS_getDocs = getDocs;
window.FS_query = query;

window.FS_doc = doc;
window.FS_getDoc = getDoc;
window.FS_deleteDoc = deleteDoc;

console.log("üî• Firebase + Firestore poprawnie zainicjalizowane!");
</script>





<!-- ============================================== -->
<!-- üî• 2. TERAZ dopiero Twoje wszystkie skrypty     -->
<!--    (wszystkie bƒôdƒÖ mia≈Çy dostƒôp do firebaseDB) -->
<!-- ============================================== -->

<script src="edytor.js"></script>
<script src="importdanych.js"></script>
<script src="baner.js"></script>

<!-- je≈õli plik u≈ºywa import√≥w ‚Äì musi byƒá module -->
<script type="module" src="importdanych-1.js"></script>

<script src="edycja.js"></script>
<script src="edycja-1.js"></script>
<script src="okladka.js"></script>
<script src="dodajstrone.js"></script>
<script src="eangenerator.js"></script>
<script src="rysowanie.js"></script>


<!-- üî• 3. Save/load system -->
<script type="module" src="saveall.js"></script>

  <!-- INICJALIZACJA -->
  <script>
    // === PREVIEW UPLOAD√ìW (POD KARTƒÑ) ===
    function setupUpload(zoneId, inputId, previewId) {
      const zone = document.getElementById(zoneId);
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);

      if (!zone || !input || !preview) return;

      input.addEventListener('change', () => {
        const file = input.files[0];
        if (!file) {
          preview.innerHTML = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.cssText = 'max-width:100%; max-height:80px; margin-top:8px; border-radius:6px;';
          preview.innerHTML = '';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });

      ['dragover', 'dragenter'].forEach(e => zone.addEventListener(e, ev => ev.preventDefault()));
      zone.addEventListener('drop', ev => {
        ev.preventDefault();
        const file = ev.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          const dt = new DataTransfer();
          dt.items.add(file);
          input.files = dt.files;
          input.dispatchEvent(new Event('change'));
        }
      });
    }

    // === INICJALIZACJA ===
    document.addEventListener('DOMContentLoaded', () => {
      setupUpload('bannerUpload', 'bannerFileInput', 'bannerPreview');
      setupUpload('backgroundUpload', 'backgroundFileInput', 'backgroundPreview');
      setupUpload('coverUpload', 'coverFileInput', 'coverPreview');

      const importExcelBtn = document.getElementById('importExcelBtn');
      const importImagesBtn = document.getElementById('importImagesBtn');
      const pdfButton = document.getElementById('pdfButton');
      const catalogSettingsBtn = document.getElementById('catalogSettingsBtn');
const canvaPdfButton = document.getElementById('canvaPdfButton');

      if (importExcelBtn) {
        importExcelBtn.onclick = () => {
          if (typeof importExcelMultiPage === 'function') importExcelMultiPage();
          else console.error('importExcelMultiPage nie za≈Çadowane');
        };
      }

      if (importImagesBtn) {
        importImagesBtn.onclick = () => {
          if (typeof importImagesFromFiles === 'function') importImagesFromFiles();
          else console.error('importImagesFromFiles nie za≈Çadowane');
        };
      }

   // Zmie≈Ñ ten fragment:
if (pdfButton) {
  pdfButton.onclick = () => {
    if (typeof window.generatePDF === 'function') {
      window.generatePDF();
    } else {
      console.error('generatePDF nie jest dostƒôpne');
    }
  };
}
if (canvaPdfButton) {
  canvaPdfButton.onclick = () => {
    if (typeof window.generateCanvaPDF === 'function') {
      window.generateCanvaPDF();
    } else {
      console.error('generateCanvaPDF nie jest dostƒôpne');
    }
  };
}


      const excelFile = document.getElementById('excelFile');
      if (excelFile) {
        excelFile.addEventListener('change', () => {
          const name = excelFile.files[0]?.name || 'Nie wybrano pliku';
          const label = document.getElementById('fileLabel');
          if (label) label.textContent = name;
        });
      }

      window.addEventListener('excelImported', () => {
        if (pdfButton) pdfButton.disabled = false;
      });

      if (typeof Quill === 'undefined') {
        console.error('QUILL.JS NIE ZA≈ÅADOWANY!');
      } else {
        console.log('QUILL.JS DZIA≈ÅA!');
      }
    });
  </script>
<!-- üî• MODAL: ZAPISZ PROJEKT -->
<div id="saveProjectModal" 
     style="
        display:none; 
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        background:rgba(0,0,0,0.45);
        z-index:999999;
        justify-content:center;
        align-items:center;
     ">
  
  <div style="
      width:360px;
      background:white;
      padding:24px;
      border-radius:12px;
      box-shadow:0 10px 40px rgba(0,0,0,0.25);
      font-family:Inter, Arial;
  ">
      <h2 style="margin-top:0; font-size:20px; font-weight:600;">
        Zapisz projekt
      </h2>

      <label>Nazwa projektu:</label>
      <input id="projectNameInput"
             type="text"
             placeholder="np. Rumunia grudzie≈Ñ 2025"
             style="width:100%; padding:8px; margin:6px 0 12px 0;
                    border:1px solid #ccc; border-radius:6px;">

      <label>Data utworzenia:</label>
      <input id="projectDateInput"
             type="date"
             style="width:100%; padding:8px; margin:6px 0 20px 0;
                    border:1px solid #ccc; border-radius:6px;">

      <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button id="cancelSaveBtn" 
                  style="padding:8px 14px; border:none; border-radius:6px; background:#ddd;">
            Anuluj
          </button>

          <button id="confirmSaveBtn"
                  style="padding:8px 14px; border:none; border-radius:6px; background:#0077ff; color:white;">
            Zapisz
          </button>
      </div>
  </div>

</div>

</body>
</html>
